# 디바이스 시리얼 번호 할당 서버

제조 과정에서 디바이스에 시리얼 번호를 설정하는 프로그램입니다.

## 기능

- 초기 UID가 "FFFFFFFF"인 디바이스가 5080 포트로 접속하면 새 시리얼 번호 할당
- 명령줄에서 지정한 시리얼 번호(USN)를 사용하여 디바이스 UID 변경
- 한 번에 하나의 디바이스 처리 (단일 연결 후 프로그램 종료)
- 256바이트 패킷 확인 및 처리

## 요구 사항

- C 컴파일러 (GCC 권장)
- POSIX 호환 시스템 (Linux)

## 설치 방법

### Linux 시스템

```bash
# 필요한 패키지 설치
sudo apt-get update
sudo apt-get install -y gcc make

# 빌드
cd manufacture
make
```

## 사용 방법

```bash
./serializer [새로운_USN]
```

예시:
```bash
./serializer FB6E88BE
```

이 명령어는 서버를 시작하고, UID가 "FFFFFFFF"인 디바이스가 연결될 때 새 USN을 "FB6E88BE"로 변경합니다.
작업이 완료되면 프로그램은 자동으로 종료됩니다.

## 동작 방식

1. 명령줄에서 새로운 USN을 입력받아 서버를 시작합니다.
2. 서버가 5080 포트에서 디바이스 연결을 기다립니다.
3. 디바이스가 연결되면 256바이트 업스트림 패킷을 수신합니다.
4. 패킷의 UID 부분이 "FFFFFFFF"인 경우, 명령줄에서 입력받은 USN으로 변경합니다.
5. 다운스트림 패킷을 통해 디바이스에 새 시리얼 번호를 전송합니다.
6. 새로 할당된 UID로 디바이스가 메인 서버(5004 포트)에 접속하도록 서버 정보를 전달합니다.
7. 작업 결과 메시지를 출력하고 프로그램을 종료합니다.

## 출력 메시지

- 서버 시작 및 포트 정보
- 새 USN 정보 출력
- 디바이스 연결 확인
- 256바이트 패킷 수신 확인
- UID 확인 및 변경 처리
- 작업 결과 메시지

## 종료 코드

- 성공 (0): USN 변경 성공 또는 변경 불필요
- 실패 (1): 인수 오류, 서버 생성 실패, 연결 실패, 패킷 처리 오류 등

## 문제 해결

### Q: 디바이스에 시리얼 번호가 할당되지 않습니다
A: 디바이스가 올바른 형식의 패킷을 보내고 있는지, UID 필드가 정확히 "FFFFFFFF"인지 확인하세요.

### Q: 올바른 USN 형식은 무엇인가요?
A: USN은 정확히 8자리의 영숫자여야 합니다. 예시: FB6E88BE

### Q: 서버가 시작되지 않습니다
A: 5080 포트가 이미 사용 중이 아닌지 확인하세요.

## 라이센스

이 프로젝트는 내부 사용 목적으로 개발되었습니다. 